---
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<main class="min-h-screen bg-sky-50 flex items-center justify-center px-6 py-24">

		<!-- Soft gradient blobs -->
		<div class="fixed top-0 right-0 w-[600px] h-[600px] bg-[#0C6B95]/6 rounded-full blur-3xl -translate-y-1/3 translate-x-1/4 pointer-events-none"></div>
		<div class="fixed bottom-0 left-0 w-[400px] h-[400px] bg-sky-100/60 rounded-full blur-3xl translate-y-1/3 -translate-x-1/4 pointer-events-none"></div>

		<div class="relative z-10 w-full max-w-xl">

			<!-- Logo -->
			<div class="flex justify-center mb-8">
				<a href="/" aria-label="Go to homepage">
					<img src="/logo-opawey.png" alt="Opawey" class="h-16 w-auto object-contain" />
				</a>
			</div>

			<!-- Card -->
			<div class="bg-white rounded-3xl border border-neutral-200 shadow-xl shadow-neutral-200/60 p-8 lg:p-10">

				<!-- Header -->
				<div class="mb-8">
					<div class="flex items-center gap-2 mb-3">
						<span class="w-2 h-2 rounded-full bg-[#0C6B95] shrink-0"></span>
						<span class="text-xs font-medium text-[#0C6B95] tracking-widest uppercase">Partner Access</span>
					</div>
					<h1 class="text-3xl font-bold text-neutral-900">Become a Partner</h1>
					<p class="text-neutral-500 text-sm mt-1">Select your partner type and fill in your details to apply.</p>
				</div>

				<!-- Auth / form error -->
				<div id="auth-error" class="hidden mb-4 p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-sm" role="alert"></div>

				<!-- ── Partner type dropdown ── -->
				<div class="flex flex-col gap-1.5 mb-6">
					<label for="partner-type" class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Partner Type</label>
					<div class="relative">
						<select
							id="partner-type"
							class="w-full appearance-none pl-4 pr-10 py-3.5 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm cursor-pointer"
						>
							<option value="" disabled selected>Select partner type…</option>
							<option value="hotel">Hotels &amp; Boutiques</option>
							<option value="agency">Travel Agencies</option>
							<option value="driver">Drivers</option>
						</select>
						<span class="absolute right-3.5 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none">
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
								<path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
							</svg>
						</span>
					</div>
				</div>

				<!-- ── Form body (shown after type selection) ── -->
				<form id="partner-form" class="hidden flex-col gap-5" novalidate>

					<!-- Type badge -->
					<div id="type-badge" class="flex items-center gap-3 px-4 py-3 rounded-xl border mb-1"></div>

					<!-- ══════════════════════════════════════
					     HOTEL / BOUTIQUE FIELDS
					     ══════════════════════════════════════ -->
					<div id="fields-hotel" class="flex flex-col gap-5" style="display:none">

						<!-- Business Information -->
						<div class="flex items-center gap-3 py-1">
							<div class="flex-1 h-px bg-neutral-100"></div>
							<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Business Information</span>
							<div class="flex-1 h-px bg-neutral-100"></div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Hotel or Boutique Name *</label>
							<input id="h-name" type="text" placeholder="e.g. Aegean Boutique Hotel"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Type *</label>
							<div class="relative">
								<select id="h-type"
									class="w-full appearance-none px-4 pr-10 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm cursor-pointer">
									<option value="" disabled selected>Select type…</option>
									<option>Hotel</option>
									<option>Boutique Hotel</option>
									<option>Resort</option>
									<option>Villa</option>
									<option>B&amp;B</option>
									<option>Other</option>
								</select>
								<span class="absolute right-3.5 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
								</span>
							</div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">VAT Number *</label>
							<input id="h-vat" type="text" placeholder="e.g. EL123456789"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Phone *</label>
								<input id="h-phone" type="tel" placeholder="e.g. +30 210…"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Email *</label>
								<input id="h-email" type="email" placeholder="e.g. info@hotel.com"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
						</div>

						<!-- Contact Person -->
						<div class="flex items-center gap-3 py-1">
							<div class="flex-1 h-px bg-neutral-100"></div>
							<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Contact Person</span>
							<div class="flex-1 h-px bg-neutral-100"></div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Contact Person Name *</label>
							<input id="h-contact-name" type="text" placeholder="e.g. Maria Papadopoulou"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Contact Phone *</label>
								<input id="h-contact-phone" type="tel" placeholder="e.g. +30 69…"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Contact Email *</label>
								<input id="h-contact-email" type="email" placeholder="e.g. maria@hotel.com"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
						</div>

						<!-- Property Details -->
						<div class="flex items-center gap-3 py-1">
							<div class="flex-1 h-px bg-neutral-100"></div>
							<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Property Details</span>
							<div class="flex-1 h-px bg-neutral-100"></div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Location / Address *</label>
							<input id="h-location" type="text" placeholder="e.g. Mykonos, Greece"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Website <span class="normal-case text-neutral-400 font-normal">(optional)</span></label>
							<input id="h-website" type="url" placeholder="https://www.yourhotel.com"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

					</div>

					<!-- ══════════════════════════════════════
					     TRAVEL AGENCY FIELDS
					     ══════════════════════════════════════ -->
					<div id="fields-agency" class="flex flex-col gap-5" style="display:none">

						<!-- Business Information -->
						<div class="flex items-center gap-3 py-1">
							<div class="flex-1 h-px bg-neutral-100"></div>
							<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Business Information</span>
							<div class="flex-1 h-px bg-neutral-100"></div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Agency Name *</label>
							<input id="a-name" type="text" placeholder="e.g. Hellas Travel Group"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Type *</label>
							<div class="relative">
								<select id="a-type"
									class="w-full appearance-none px-4 pr-10 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm cursor-pointer">
									<option value="" disabled selected>Select type…</option>
									<option>General Travel Agency</option>
									<option>Tour Operator</option>
									<option>MICE Agency</option>
									<option>Inbound Agency</option>
									<option>Other</option>
								</select>
								<span class="absolute right-3.5 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
								</span>
							</div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">VAT Number *</label>
							<input id="a-vat" type="text" placeholder="e.g. EL123456789"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Agency Phone *</label>
								<input id="a-phone" type="tel" placeholder="e.g. +30 210…"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Agency Email *</label>
								<input id="a-email" type="email" placeholder="e.g. info@agency.com"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
						</div>

						<!-- Contact Person -->
						<div class="flex items-center gap-3 py-1">
							<div class="flex-1 h-px bg-neutral-100"></div>
							<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Contact Person</span>
							<div class="flex-1 h-px bg-neutral-100"></div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Contact Person Name *</label>
							<input id="a-contact-name" type="text" placeholder="e.g. Nikos Papadimitriou"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Contact Person Email *</label>
								<input id="a-contact-email" type="email" placeholder="e.g. nikos@agency.com"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Contact Person Phone *</label>
								<input id="a-contact-phone" type="tel" placeholder="e.g. +30 69…"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
						</div>

						<!-- Agency Details -->
						<div class="flex items-center gap-3 py-1">
							<div class="flex-1 h-px bg-neutral-100"></div>
							<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Agency Details</span>
							<div class="flex-1 h-px bg-neutral-100"></div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Location / Address *</label>
							<input id="a-location" type="text" placeholder="e.g. Athens, Greece"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Website <span class="normal-case text-neutral-400 font-normal">(optional)</span></label>
							<input id="a-website" type="url" placeholder="https://www.youragency.com"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

					</div>

					<!-- ══════════════════════════════════════
					     DRIVER FIELDS
					     ══════════════════════════════════════ -->
					<div id="fields-driver" class="flex flex-col gap-5" style="display:none">

						<!-- Personal Information -->
						<div class="flex items-center gap-3 py-1">
							<div class="flex-1 h-px bg-neutral-100"></div>
							<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Personal Information</span>
							<div class="flex-1 h-px bg-neutral-100"></div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Full Name *</label>
							<input id="d-name" type="text" placeholder="e.g. Kostas Nikolaou"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Phone *</label>
								<input id="d-phone" type="tel" placeholder="e.g. +30 69…"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
							<div class="flex flex-col gap-1.5">
								<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Email *</label>
								<input id="d-email" type="email" placeholder="e.g. kostas@email.com"
									class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							</div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">VAT Number *</label>
							<input id="d-vat" type="text" placeholder="e.g. EL123456789"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<!-- Vehicle Information -->
						<div class="flex items-center gap-3 py-1">
							<div class="flex-1 h-px bg-neutral-100"></div>
							<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Vehicle Information</span>
							<div class="flex-1 h-px bg-neutral-100"></div>
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Number of Vehicles *</label>
							<input id="d-num-vehicles" type="number" min="1" placeholder="e.g. 3"
								class="w-full px-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>

						<div class="flex flex-col gap-1.5">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Type of Car *</label>
							<div class="relative">
								<select id="d-car-type"
									class="w-full appearance-none px-4 pr-10 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm cursor-pointer">
									<option value="" disabled selected>Select primary vehicle…</option>
									<option>Sedan</option>
									<option>SUV</option>
									<option>Van</option>
									<option>Minibus</option>
									<option>Bus</option>
									<option>Luxury</option>
									<option>Other</option>
								</select>
								<span class="absolute right-3.5 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
								</span>
							</div>
						</div>

						<!-- Types of Cars checkboxes -->
						<div class="flex flex-col gap-2">
							<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Types of Cars in Fleet</label>
							<div class="grid grid-cols-2 sm:grid-cols-3 gap-2.5">
								{['Sedan', 'SUV', 'Van', 'Minibus', 'Bus', 'Luxury'].map((car) => (
									<label class="flex items-center gap-2.5 cursor-pointer p-2.5 rounded-lg border border-neutral-200 hover:border-[#0C6B95]/40 hover:bg-sky-50/50 transition-colors select-none">
										<input type="checkbox" name="d-car-types" value={car}
											class="w-4 h-4 rounded border-neutral-300 cursor-pointer accent-[#0C6B95]" />
										<span class="text-sm text-neutral-700">{car}</span>
									</label>
								))}
							</div>
						</div>

					</div>

					<!-- ── Account Details ── -->
					<div class="flex items-center gap-3 py-1">
						<div class="flex-1 h-px bg-neutral-100"></div>
						<span class="text-xs text-neutral-400 font-medium uppercase tracking-widest">Account Details</span>
						<div class="flex-1 h-px bg-neutral-100"></div>
					</div>

					<!-- Password -->
					<div class="flex flex-col gap-1.5">
						<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Password *</label>
						<div class="relative">
							<span class="absolute left-3.5 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none">
								<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
								</svg>
							</span>
							<input id="p-password" type="password" placeholder="Min. 8 characters" autocomplete="new-password"
								class="w-full pl-10 pr-11 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
							<button type="button" id="toggle-pw" class="absolute right-3.5 top-1/2 -translate-y-1/2 text-neutral-400 hover:text-neutral-600 transition-colors" aria-label="Toggle password visibility">
								<svg id="eye-on" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
									<path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
								</svg>
								<svg id="eye-off" class="w-4 h-4 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
								</svg>
							</button>
						</div>
						<!-- Strength bar -->
						<div id="strength-wrap" class="flex gap-1 mt-1 hidden">
							<div class="h-1 flex-1 rounded-full bg-neutral-200 overflow-hidden"><div id="s1" class="h-full w-0 rounded-full transition-all duration-300"></div></div>
							<div class="h-1 flex-1 rounded-full bg-neutral-200 overflow-hidden"><div id="s2" class="h-full w-0 rounded-full transition-all duration-300"></div></div>
							<div class="h-1 flex-1 rounded-full bg-neutral-200 overflow-hidden"><div id="s3" class="h-full w-0 rounded-full transition-all duration-300"></div></div>
							<div class="h-1 flex-1 rounded-full bg-neutral-200 overflow-hidden"><div id="s4" class="h-full w-0 rounded-full transition-all duration-300"></div></div>
						</div>
						<p id="strength-label" class="text-xs text-neutral-400 hidden"></p>
					</div>

					<!-- Confirm Password -->
					<div class="flex flex-col gap-1.5">
						<label class="text-neutral-700 text-xs font-medium uppercase tracking-widest">Confirm Password *</label>
						<div class="relative">
							<span class="absolute left-3.5 top-1/2 -translate-y-1/2 text-neutral-400 pointer-events-none">
								<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
								</svg>
							</span>
							<input id="p-confirm" type="password" placeholder="Repeat your password" autocomplete="new-password"
								class="w-full pl-10 pr-4 py-3 bg-neutral-50 border border-neutral-200 rounded-xl text-neutral-800 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-[#0C6B95]/20 focus:border-[#0C6B95] transition-colors text-sm" />
						</div>
						<p id="match-msg" class="text-xs hidden"></p>
					</div>

					<!-- Terms -->
					<label class="flex items-start gap-3 cursor-pointer select-none">
						<div class="relative shrink-0 mt-0.5">
							<input type="checkbox" id="p-terms" class="peer sr-only" />
							<div class="w-5 h-5 rounded-md border-2 border-neutral-300 bg-white peer-checked:bg-[#0C6B95] peer-checked:border-[#0C6B95] transition-colors flex items-center justify-center">
								<svg class="w-3 h-3 text-white opacity-0 peer-checked:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
									<path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
								</svg>
							</div>
						</div>
						<span class="text-sm text-neutral-600 leading-relaxed">
							I agree to the
							<a href="/terms" class="text-[#0C6B95] font-medium hover:underline">Terms of Service</a>
							and
							<a href="/privacy" class="text-[#0C6B95] font-medium hover:underline">Privacy Policy</a>
						</span>
					</label>

					<!-- Submit -->
					<button type="submit" id="p-submit"
						class="w-full py-3.5 bg-[#0C6B95] hover:bg-[#0a5c82] text-white font-semibold rounded-xl transition-colors duration-200 flex items-center justify-center gap-2 shadow-lg shadow-[#0C6B95]/25 mt-1 disabled:opacity-60 disabled:cursor-not-allowed">
						Submit Application
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
							<path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
						</svg>
					</button>

				</form>

				<!-- Footer links -->
				<div class="mt-6 flex flex-col gap-2 text-center text-sm text-neutral-500">
					<p>
						Already have an account?
						<a href="/login" class="text-[#0C6B95] font-semibold hover:text-[#0a5c82] transition-colors">Sign in</a>
					</p>
					<p>
						Not a partner?
						<a href="/register" class="text-[#0C6B95] font-semibold hover:text-[#0a5c82] transition-colors">Create a regular account</a>
					</p>
				</div>

			</div>
		</div>
	</main>
</Layout>

<script>
	import { auth, db } from '../lib/firebase';
	import { createUserWithEmailAndPassword, signOut } from 'firebase/auth';
	import { doc, setDoc, serverTimestamp } from 'firebase/firestore';

	/* ── Type metadata ── */
	const TYPE_META: Record<string, { label: string; color: string; icon: string }> = {
		hotel: {
			label: 'Hotels & Boutiques',
			color: 'bg-sky-50 border-sky-200 text-sky-700',
			icon: `<svg class="w-5 h-5 text-[#0C6B95]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>`,
		},
		agency: {
			label: 'Travel Agencies',
			color: 'bg-violet-50 border-violet-200 text-violet-700',
			icon: `<svg class="w-5 h-5 text-violet-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 004 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
		},
		driver: {
			label: 'Drivers',
			color: 'bg-neutral-50 border-neutral-200 text-neutral-700',
			icon: `<svg class="w-5 h-5 text-neutral-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>`,
		},
	};

	const $ = (id: string) => document.getElementById(id);

	const partnerTypeSel = $('partner-type') as HTMLSelectElement;
	const form           = $('partner-form') as HTMLFormElement;
	const typeBadge      = $('type-badge')!;
	const errorEl        = $('auth-error')!;
	const submitBtn      = $('p-submit') as HTMLButtonElement;

	/* ── Show / hide form on type selection ── */
	partnerTypeSel.addEventListener('change', () => {
		const type = partnerTypeSel.value;
		const meta = TYPE_META[type];
		if (!meta) return;

		form.classList.remove('hidden');
		form.style.display = 'flex';

		typeBadge.className = `flex items-center gap-3 px-4 py-3 rounded-xl border mb-1 ${meta.color}`;
		typeBadge.innerHTML = `${meta.icon}<span class="text-sm font-semibold">${meta.label}</span>`;

		['hotel', 'agency', 'driver'].forEach(t => {
			const el = $(`fields-${t}`) as HTMLElement;
			if (el) el.style.display = t === type ? 'flex' : 'none';
		});

		errorEl.classList.add('hidden');
	});

	/* ── Password toggle ── */
	const pwInput = $('p-password') as HTMLInputElement;
	$('toggle-pw')?.addEventListener('click', () => {
		const hidden = pwInput.type === 'password';
		pwInput.type = hidden ? 'text' : 'password';
		$('eye-on')?.classList.toggle('hidden', hidden);
		$('eye-off')?.classList.toggle('hidden', !hidden);
	});

	/* ── Password strength ── */
	const strengthWrap  = $('strength-wrap')!;
	const strengthLabel = $('strength-label')!;
	const segments      = ['s1', 's2', 's3', 's4'].map(id => $(id));
	const colors        = ['bg-red-400', 'bg-orange-400', 'bg-yellow-400', 'bg-green-500'];
	const labels        = ['Weak', 'Fair', 'Good', 'Strong'];

	function getStrength(pwd: string): number {
		let s = 0;
		if (pwd.length >= 8) s++;
		if (/[A-Z]/.test(pwd)) s++;
		if (/[0-9]/.test(pwd)) s++;
		if (/[^A-Za-z0-9]/.test(pwd)) s++;
		return s;
	}

	pwInput.addEventListener('input', () => {
		const v = pwInput.value;
		if (!v) { strengthWrap.classList.add('hidden'); strengthLabel.classList.add('hidden'); return; }
		strengthWrap.classList.remove('hidden');
		strengthLabel.classList.remove('hidden');
		const score = getStrength(v);
		segments.forEach((seg, i) => {
			if (!seg) return;
			seg.className = 'h-full rounded-full transition-all duration-300';
			seg.style.width = i < score ? '100%' : '0';
			if (i < score) seg.classList.add(colors[score - 1]);
		});
		strengthLabel.textContent = labels[score - 1] ?? '';
		strengthLabel.className = `text-xs ${['text-red-400','text-orange-400','text-yellow-500','text-green-500'][score - 1] ?? 'text-neutral-400'}`;
		checkMatch();
	});

	/* ── Password match ── */
	const confirmInput = $('p-confirm') as HTMLInputElement;
	const matchMsg     = $('match-msg')!;
	function checkMatch() {
		if (!confirmInput.value) { matchMsg.classList.add('hidden'); return; }
		const ok = pwInput.value === confirmInput.value;
		matchMsg.classList.remove('hidden');
		matchMsg.textContent = ok ? 'Passwords match' : 'Passwords do not match';
		matchMsg.className   = `text-xs ${ok ? 'text-green-500' : 'text-red-400'}`;
	}
	confirmInput.addEventListener('input', checkMatch);

	/* ── Helpers ── */
	function showError(msg: string) {
		errorEl.textContent = msg;
		errorEl.classList.remove('hidden');
		errorEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
	}
	function hideError() { errorEl.classList.add('hidden'); }
	function getInputVal(id: string) { return ($(id) as HTMLInputElement | null)?.value.trim() ?? ''; }

	/* ── Submit ── */
	form.addEventListener('submit', async (e) => {
		e.preventDefault();
		hideError();

		const type     = partnerTypeSel.value;
		const password = ($('p-password') as HTMLInputElement).value;
		const confirm  = ($('p-confirm')  as HTMLInputElement).value;
		const terms    = ($('p-terms')    as HTMLInputElement).checked;

		if (!type)               { showError('Please select a partner type.'); return; }
		if (password.length < 8) { showError('Password must be at least 8 characters.'); return; }
		if (password !== confirm) { showError('Passwords do not match.'); return; }
		if (!terms)              { showError('Please accept the Terms of Service.'); return; }

		// Resolve auth email & display name per type + validate required fields
		let authEmail   = '';
		let displayName = '';

		if (type === 'hotel') {
			authEmail   = getInputVal('h-contact-email');
			displayName = getInputVal('h-contact-name');
			if (!getInputVal('h-name'))          { showError('Please enter the hotel or boutique name.'); return; }
			if (!getInputVal('h-type'))          { showError('Please select a property type.'); return; }
			if (!getInputVal('h-vat'))           { showError('Please enter your VAT number.'); return; }
			if (!getInputVal('h-phone'))         { showError('Please enter the business phone.'); return; }
			if (!getInputVal('h-email'))         { showError('Please enter the business email.'); return; }
			if (!displayName)                    { showError('Please enter the contact person name.'); return; }
			if (!getInputVal('h-contact-phone')) { showError('Please enter the contact person phone.'); return; }
			if (!authEmail)                      { showError('Please enter the contact person email.'); return; }
			if (!getInputVal('h-location'))      { showError('Please enter the property location.'); return; }
		} else if (type === 'agency') {
			authEmail   = getInputVal('a-contact-email');
			displayName = getInputVal('a-contact-name');
			if (!getInputVal('a-name'))          { showError('Please enter the agency name.'); return; }
			if (!getInputVal('a-type'))          { showError('Please select an agency type.'); return; }
			if (!getInputVal('a-vat'))           { showError('Please enter your VAT number.'); return; }
			if (!getInputVal('a-phone'))         { showError('Please enter the agency phone.'); return; }
			if (!getInputVal('a-email'))         { showError('Please enter the agency email.'); return; }
			if (!displayName)                    { showError('Please enter the contact person name.'); return; }
			if (!authEmail)                      { showError('Please enter the contact person email.'); return; }
			if (!getInputVal('a-contact-phone')) { showError('Please enter the contact person phone.'); return; }
			if (!getInputVal('a-location'))      { showError('Please enter the agency location.'); return; }
		} else if (type === 'driver') {
			authEmail   = getInputVal('d-email');
			displayName = getInputVal('d-name');
			if (!displayName)                    { showError('Please enter your full name.'); return; }
			if (!getInputVal('d-phone'))         { showError('Please enter your phone number.'); return; }
			if (!authEmail)                      { showError('Please enter your email address.'); return; }
			if (!getInputVal('d-vat'))           { showError('Please enter your VAT number.'); return; }
			if (!getInputVal('d-num-vehicles'))  { showError('Please enter the number of vehicles.'); return; }
			if (!getInputVal('d-car-type'))      { showError('Please select your primary car type.'); return; }
		}

		if (!authEmail) { showError('Email address is required.'); return; }

		submitBtn.disabled = true;
		submitBtn.innerHTML = `<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path></svg> Submitting…`;

		try {
			// 1. Create Firebase Auth account
			const { user } = await createUserWithEmailAndPassword(auth, authEmail, password);

			// 2. Force token propagation so Firestore rules can verify the uid
			await user.getIdToken(true);

			// 3. Build partners document
			//    type field: hotel | agency | driver
			const TYPE_MAP: Record<string, string> = {
				hotel:  'hotel',
				agency: 'agency',
				driver: 'driver',
			};

			const partnerData: Record<string, unknown> = {
				uid:         user.uid,
				email:       authEmail,
				displayName,
				type:        TYPE_MAP[type],
				status:      'pending',
				provider:    'email',
				createdAt:   serverTimestamp(),
			};

			if (type === 'hotel') {
				partnerData.hotelName     = getInputVal('h-name');
				partnerData.hotelType     = getInputVal('h-type');
				partnerData.vat           = getInputVal('h-vat');
				partnerData.businessPhone = getInputVal('h-phone');
				partnerData.businessEmail = getInputVal('h-email');
				partnerData.contactName   = displayName;
				partnerData.contactPhone  = getInputVal('h-contact-phone');
				partnerData.contactEmail  = authEmail;
				partnerData.location      = getInputVal('h-location');
				partnerData.website       = getInputVal('h-website') || null;
			} else if (type === 'agency') {
				partnerData.agencyName    = getInputVal('a-name');
				partnerData.agencyType    = getInputVal('a-type');
				partnerData.vat           = getInputVal('a-vat');
				partnerData.agencyPhone   = getInputVal('a-phone');
				partnerData.agencyEmail   = getInputVal('a-email');
				partnerData.contactName   = displayName;
				partnerData.contactEmail  = authEmail;
				partnerData.contactPhone  = getInputVal('a-contact-phone');
				partnerData.location      = getInputVal('a-location');
				partnerData.website       = getInputVal('a-website') || null;
			} else if (type === 'driver') {
				const carTypes = Array.from(
					document.querySelectorAll<HTMLInputElement>('input[name="d-car-types"]:checked')
				).map(el => el.value);
				partnerData.fullName       = displayName;
				partnerData.phone          = getInputVal('d-phone');
				partnerData.vat            = getInputVal('d-vat');
				partnerData.numVehicles    = getInputVal('d-num-vehicles');
				partnerData.primaryCarType = getInputVal('d-car-type');
				partnerData.carTypes       = carTypes;
			}

			// 4. Save to partners collection (keyed by uid)
			await setDoc(doc(db, 'partners', user.uid), partnerData);

			// 5. Sign out immediately so the partner is NOT shown as logged in
			await signOut(auth);

			// 6. Replace card with success state
			const card = document.querySelector('.bg-white.rounded-3xl') as HTMLElement;
			if (card) {
				card.innerHTML = `
					<div class="flex flex-col items-center text-center py-8 gap-5">
						<div class="w-16 h-16 rounded-full bg-emerald-100 flex items-center justify-center">
							<svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
								<path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
							</svg>
						</div>
						<div>
							<h2 class="text-2xl font-bold text-neutral-900 mb-2">Application Submitted!</h2>
							<p class="text-neutral-500 text-sm leading-relaxed max-w-xs mx-auto">
								Thank you for applying to become an Opawey partner. Our team will review your application and get back to you shortly.
							</p>
						</div>
						<div class="w-full h-px bg-neutral-100"></div>
						<a href="/" class="text-[#0C6B95] text-sm font-semibold hover:text-[#0a5c82] transition-colors">← Back to Homepage</a>
					</div>`;
			}

		} catch (err: unknown) {
			const code = err && typeof err === 'object' && 'code' in err ? (err as { code: string }).code : '';
			const msg  = err && typeof err === 'object' && 'message' in err ? String((err as { message: string }).message) : '';
			if (code === 'auth/email-already-in-use') {
				showError('This email is already registered. Try signing in instead.');
			} else if (code === 'auth/invalid-email') {
				showError('Please enter a valid email address.');
			} else {
				showError(msg || 'Registration failed. Please try again.');
			}
		} finally {
			submitBtn.disabled = false;
			submitBtn.innerHTML = `Submit Application <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>`;
		}
	});
</script>
